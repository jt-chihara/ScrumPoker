# 要件定義書

## 概要

スクラムチームが作業規模を見積もるためのオンラインプランニングポーカーツールです。参加者全員がリアルタイムで投票を行い、効率的に見積もりの合意形成を行うことができるWebアプリケーションです。バックエンドはRustで実装され、Cloudflare Workersプラットフォーム上で動作し、グローバルに高速でスケーラブルなサービスを提供します。

## 要件

### 要件1: ルーム管理機能

**ユーザーストーリー:** スクラムマスターとして、チームメンバーが参加できるプランニングポーカーのセッションを作成したい。そうすることで、チーム全体で見積もり作業を効率的に進めることができる。

#### 受入基準

1. WHEN ユーザーが名前を入力して「新しいルームを作成」をクリック THEN システムは一意のルームIDを生成してルームページに遷移する
2. WHEN ユーザーが名前とルームIDを入力して「ルームに参加」をクリック THEN システムは指定されたルームに参加させる
3. WHEN ユーザーが名前を入力せずにルーム作成または参加を試行 THEN システムはエラーメッセージを表示する
4. WHEN ユーザーがルームIDを入力せずにルーム参加を試行 THEN システムはエラーメッセージを表示する

### 要件2: リアルタイム投票機能

**ユーザーストーリー:** チームメンバーとして、他の参加者と同時に見積もり投票を行いたい。そうすることで、お互いの投票に影響されることなく独立した判断ができる。

#### 受入基準

1. WHEN ユーザーがカード値（0, 1, 2, 3, 5, 8, 13, 21, ?）を選択 THEN システムは選択されたカードを視覚的にハイライト表示する
2. WHEN ユーザーが投票を完了 THEN システムは他の参加者に投票完了状態をリアルタイムで通知する
3. WHEN 結果表示中にユーザーがカードを選択 THEN システムは投票を受け付けない
4. WHEN ユーザーが異なるカードを選択 THEN システムは前の選択を上書きして新しい選択を反映する

### 要件3: 参加者管理機能

**ユーザーストーリー:** ファシリテーターとして、誰が投票済みで誰がまだ投票していないかを把握したい。そうすることで、全員の投票完了を確認してから結果表示に進むことができる。

#### 受入基準

1. WHEN 新しいユーザーがルームに参加 THEN システムは参加者リストにユーザーを追加して他の参加者に通知する
2. WHEN ユーザーが投票を完了 THEN システムは参加者リストで該当ユーザーに投票完了マークを表示する
3. WHEN ユーザーがルームから退出 THEN システムは参加者リストからユーザーを削除して他の参加者に通知する
4. WHEN 現在のユーザーを表示 THEN システムは参加者リストで自分のエントリを「（あなた）」として識別表示する

### 要件4: 結果表示機能

**ユーザーストーリー:** チームメンバーとして、全員の投票が完了した後に結果を確認したい。そうすることで、見積もりの分散度合いを把握し、必要に応じて議論を行うことができる。

#### 受入基準

1. WHEN 全参加者が投票完了かつ「結果を表示」がクリック THEN システムは各参加者の投票値を表示する
2. WHEN 結果表示状態 THEN システムは統計情報（平均値、最高値、最低値）を計算して表示する
3. WHEN 一部の参加者が未投票 THEN システムは「結果を表示」ボタンを無効化する
4. WHEN 「?」カードが投票に含まれる THEN システムは統計計算から「?」を除外する

### 要件5: 投票リセット機能

**ユーザーストーリー:** ファシリテーターとして、議論の結果新しい見積もりが必要になった場合に投票をリセットしたい。そうすることで、同じルームで新しい投票セッションを開始できる。

#### 受入基準

1. WHEN 「リセット」ボタンがクリック THEN システムは全参加者の投票をクリアする
2. WHEN 投票がリセット THEN システムは結果表示状態を解除して新しい投票を受け付ける
3. WHEN 投票がリセット THEN システムは全参加者に投票リセットをリアルタイムで通知する
4. WHEN 投票がリセット THEN システムは統計情報表示をクリアする

### 要件6: レスポンシブデザイン

**ユーザーストーリー:** チームメンバーとして、モバイルデバイスやタブレットからもプランニングポーカーに参加したい。そうすることで、場所や使用デバイスに関係なく見積もり作業に参加できる。

#### 受入基準

1. WHEN モバイルデバイスでアクセス THEN システムはモバイル向けに最適化されたレイアウトを表示する
2. WHEN タブレットでアクセス THEN システムはタブレット向けに最適化されたレイアウトを表示する
3. WHEN デスクトップでアクセス THEN システムはデスクトップ向けの3カラムレイアウトを表示する
4. WHEN 画面サイズが変更 THEN システムは適切なレイアウトに動的に調整する

### 要件7: WebSocket通信（Cloudflare Workers対応）

**ユーザーストーリー:** チームメンバーとして、他の参加者の行動（投票、参加、退出）をリアルタイムで確認したい。そうすることで、スムーズな見積もりセッションを進行できる。

#### 受入基準

1. WHEN ユーザーがルームに参加 THEN システムはCloudflare Workers WebSocket APIを使用して他の参加者にリアルタイムで参加通知を送信する
2. WHEN ユーザーが投票完了 THEN システムはWebSocketコネクションを通じて他の参加者にリアルタイムで投票完了通知を送信する
3. WHEN ユーザーがルームから退出 THEN システムはWebSocket切断を検知して他の参加者にリアルタイムで退出通知を送信する
4. WHEN 結果表示またはリセットが実行 THEN システムは全参加者にリアルタイムで状態変更を同期する
5. WHEN WebSocketコネクションが確立 THEN システムはCloudflare Durable Objectsを使用してセッション状態を管理する

### 要件8: Cloudflareプラットフォーム対応

**ユーザーストーリー:** 開発者として、フロントエンドとバックエンドの両方をCloudflare Workersにデプロイして、グローバルに高速でスケーラブルなサービスを提供したい。そうすることで、世界中のユーザーが低レイテンシでアクセスできる。

#### 受入基準

1. WHEN アプリケーションがデプロイ THEN システムはCloudflare Workersランタイムでフルスタック動作する
2. WHEN ルーム状態を管理 THEN システムはDurable Objectsを使用して永続的な状態管理を行う
3. WHEN 静的アセット（HTML/CSS/JS）を配信 THEN システムはCloudflare Workers内から効率的に配信する
4. WHEN 環境設定を管理 THEN システムはCloudflare Workers環境変数とシークレットを使用する
5. WHEN ユーザーがアクセス THEN システムは単一のCloudflare Workersエンドポイントですべてのリクエストを処理する